name: flota-mantenimiento-pwa
region: nyc
services:
  - name: backend
    environment_slug: python
    instance_size_slug: basic-xxs
    instance_count: 1
    github:
      branch: master
      deploy_on_push: false
      repo: REPLACE_WITH_REPO
    run_command: "uvicorn main:app --host 0.0.0.0 --port 8080"
    source_dir: /
    http_port: 8080
    health_check:
      http_path: /health/ready
      initial_delay_seconds: 15
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
    envs:
      - key: ENVIRONMENT
        value: production
      - key: DATABASE_URL
        scope: RUN_AND_BUILD_TIME
        type: SECRET
        value: ${db.DATABASE_URL}
      - key: SECRET_KEY
        scope: RUN_AND_BUILD_TIME
        type: SECRET
        value: REPLACE_SECRET
      - key: CORS_ORIGINS
        value: https://REPLACE_DOMAIN
      - key: COOKIE_SECURE
        value: "true"
      - key: COOKIE_SAMESITE
        value: lax
      - key: ALLOW_SELF_REGISTER
        value: "false"
      - key: USE_S3
        value: "true"
      - key: S3_BUCKET
        value: REPLACE_BUCKET
      - key: S3_ENDPOINT
        value: nyc3.digitaloceanspaces.com
      - key: S3_REGION
        value: nyc3
      - key: S3_KEY
        type: SECRET
        value: REPLACE_S3_KEY
      - key: S3_SECRET
        type: SECRET
        value: REPLACE_S3_SECRET
databases:
  - name: db
    engine: PG
    production: true
    cluster_name: flota-maintenance-pg
